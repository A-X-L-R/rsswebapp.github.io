<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Kunjungan Kerja</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --gray: #95a5a6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            margin-top: 0;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            background-color: var(--light);
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .filter-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .schedule-table th, .schedule-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .schedule-table th {
            background-color: var(--primary);
            color: white;
        }
        
        .schedule-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .schedule-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .today {
            background-color: #ffeaa7 !important;
        }
        
        .login-form {
            text-align: center;
            margin: 20px 0;
        }
        
        input, textarea, button, select {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--secondary);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #219a52;
        }
        
        .hidden {
            display: none;
        }
        
        .admin-panel {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .notification {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .history-table th, .history-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .history-table th {
            background-color: var(--secondary);
            color: white;
        }
        
        .history-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .badge-today {
            background-color: var(--success);
            color: white;
        }
        
        .badge-upcoming {
            background-color: var(--warning);
            color: white;
        }
        
        .badge-past {
            background-color: var(--gray);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>Reiki Service Schedule Plan</h1>
        <p>Jadwal kunjungan kerja Reiki Service</p>
    </header>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('upcoming')">Jadwal Mendatang</div>
        <div class="tab" onclick="switchTab('history')">Riwayat Kunjungan</div>
    </div>
    
    <div id="upcoming-tab" class="tab-content active">
        <div class="card">
            <h2>Jadwal Kunjungan <span id="date-range"></span></h2>
            
            <div class="filter-controls">
                <button class="filter-btn active" onclick="filterSchedule('today')">Hari Ini</button>
                <button class="filter-btn" onclick="filterSchedule('tomorrow')">Besok</button>
                <button class="filter-btn" onclick="filterSchedule('next2days')">2 Hari ke Depan</button>
                <button class="filter-btn" onclick="filterSchedule('all')">Semua Jadwal</button>
            </div>
            
            <div id="schedule-container">
                <table class="schedule-table">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Waktu</th>
                            <th>Lokasi</th>
                            <th>Kegiatan</th>
                            <th>Penanggung Jawab</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- Data jadwal akan dimuat di sini -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="history-tab" class="tab-content">
        <div class="card">
            <h2>Riwayat Kunjungan</h2>
            <p>Berikut adalah daftar kunjungan kerja yang sudah terlaksana:</p>
            
            <div id="history-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Waktu</th>
                            <th>Lokasi</th>
                            <th>Kegiatan</th>
                            <th>Penanggung Jawab</th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        <!-- Data riwayat akan dimuat di sini -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="login-form" id="login-section">
        <div class="card">
            <h3>Admin Login</h3>
            <input type="password" id="password-input" placeholder="Masukkan password admin">
            <button onclick="login()">Login sebagai Admin</button>
        </div>
    </div>

    <div class="admin-panel hidden" id="admin-panel">
        <div class="card">
            <h2>Panel Admin - Kelola Jadwal</h2>
            <div id="notification"></div>
            
            <h3>Tambah Jadwal Baru</h3>
            <input type="date" id="new-date">
            <input type="time" id="new-time">
            <input type="text" id="new-location" placeholder="Lokasi">
            <textarea id="new-activity" placeholder="Deskripsi Kegiatan"></textarea>
            <input type="text" id="new-person" placeholder="Penanggung Jawab">
            <button onclick="addSchedule()">Tambah Jadwal</button>
            
            <h3>Kelola Jadwal yang Ada</h3>
            <div id="edit-schedules">
                <!-- Daftar jadwal untuk edit akan dimuat di sini -->
            </div>
        </div>
    </div>

    <script>
        // Password default (akan di-hash)
        const DEFAULT_PASSWORD = "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8"; // password: "password"
        let isAuthenticated = false;
        let currentFilter = 'today';
        
        // Fungsi untuk hash password menggunakan SHA-256 sederhana
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        // Fungsi login
        async function login() {
            const passwordInput = document.getElementById('password-input').value;
            const hashedPassword = await sha256(passwordInput);
            
            if (hashedPassword === DEFAULT_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                showNotification('Login berhasil!', 'success');
                loadEditSchedules();
            } else {
                showNotification('Password salah!', 'error');
            }
        }
        
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type) {
            const notificationEl = document.getElementById('notification');
            notificationEl.textContent = message;
            notificationEl.className = `notification ${type}`;
            setTimeout(() => {
                notificationEl.textContent = '';
                notificationEl.className = 'notification';
            }, 3000);
        }
        
        // Fungsi untuk beralih antara tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab:nth-child(${tabName === 'upcoming' ? 1 : 2})`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'history') {
                loadHistory();
            } else {
                loadSchedules(currentFilter);
            }
        }
        
        // Fungsi untuk memfilter jadwal
        function filterSchedule(filterType) {
            currentFilter = filterType;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.filter-btn:nth-child(${
                filterType === 'today' ? 1 : 
                filterType === 'tomorrow' ? 2 : 
                filterType === 'next2days' ? 3 : 4
            })`).classList.add('active');
            
            loadSchedules(filterType);
        }
        
        // Memuat jadwal dari localStorage dengan filter
        function loadSchedules(filterType = 'today') {
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            const scheduleBody = document.getElementById('schedule-body');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const dayAfterTomorrow = new Date(today);
            dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
            
            const next2Days = new Date(today);
            next2Days.setDate(next2Days.getDate() + 3);
            
            // Filter jadwal berdasarkan pilihan
            let filteredSchedules = schedules.filter(schedule => {
                const scheduleDate = new Date(schedule.date);
                scheduleDate.setHours(0, 0, 0, 0);
                
                if (filterType === 'today') {
                    return scheduleDate.getTime() === today.getTime();
                } else if (filterType === 'tomorrow') {
                    return scheduleDate.getTime() === tomorrow.getTime();
                } else if (filterType === 'next2days') {
                    return scheduleDate >= tomorrow && scheduleDate < next2Days;
                } else {
                    return scheduleDate >= today;
                }
            });
            
            // Urutkan jadwal berdasarkan tanggal
            filteredSchedules.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            scheduleBody.innerHTML = '';
            
            if (filteredSchedules.length === 0) {
                scheduleBody.innerHTML = '<tr><td colspan="5" class="empty-state">Tidak ada jadwal untuk ditampilkan</td></tr>';
                updateDateRange(filterType, today, tomorrow, dayAfterTomorrow);
                return;
            }
            
            filteredSchedules.forEach(schedule => {
                const scheduleDate = new Date(schedule.date);
                scheduleDate.setHours(0, 0, 0, 0);
                
                const row = document.createElement('tr');
                if (scheduleDate.getTime() === today.getTime()) {
                    row.classList.add('today');
                }
                
                row.innerHTML = `
                    <td>${formatDate(schedule.date)} ${scheduleDate.getTime() === today.getTime() ? '<span class="badge badge-today">Hari Ini</span>' : ''}</td>
                    <td>${schedule.time}</td>
                    <td>${schedule.location}</td>
                    <td>${schedule.activity}</td>
                    <td>${schedule.person}</td>
                `;
                scheduleBody.appendChild(row);
            });
            
            updateDateRange(filterType, today, tomorrow, dayAfterTomorrow);
        }
        
        // Memperbarui teks rentang tanggal
        function updateDateRange(filterType, today, tomorrow, dayAfterTomorrow) {
            const dateRangeEl = document.getElementById('date-range');
            
            const formatOptions = { day: 'numeric', month: 'long', year: 'numeric' };
            
            if (filterType === 'today') {
                dateRangeEl.textContent = `- ${today.toLocaleDateString('id-ID', formatOptions)}`;
            } else if (filterType === 'tomorrow') {
                dateRangeEl.textContent = `- ${tomorrow.toLocaleDateString('id-ID', formatOptions)}`;
            } else if (filterType === 'next2days') {
                dateRangeEl.textContent = `- ${tomorrow.toLocaleDateString('id-ID', formatOptions)} hingga ${dayAfterTomorrow.toLocaleDateString('id-ID', formatOptions)}`;
            } else {
                dateRangeEl.textContent = '- Semua Jadwal Mendatang';
            }
        }
        
        // Memuat riwayat kunjungan
        function loadHistory() {
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            const historyBody = document.getElementById('history-body');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Filter hanya jadwal yang sudah lewat
            const pastSchedules = schedules.filter(schedule => {
                const scheduleDate = new Date(schedule.date);
                scheduleDate.setHours(0, 0, 0, 0);
                return scheduleDate < today;
            });
            
            // Urutkan dari yang terbaru
            pastSchedules.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            historyBody.innerHTML = '';
            
            if (pastSchedules.length === 0) {
                historyBody.innerHTML = '<tr><td colspan="5" class="empty-state">Belum ada riwayat kunjungan</td></tr>';
                return;
            }
            
            pastSchedules.forEach(schedule => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(schedule.date)}</td>
                    <td>${schedule.time}</td>
                    <td>${schedule.location}</td>
                    <td>${schedule.activity}</td>
                    <td>${schedule.person}</td>
                `;
                historyBody.appendChild(row);
            });
        }
        
        // Memformat tanggal untuk tampilan
        function formatDate(dateString) {
            const options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
        
        // Memuat jadwal untuk edit
        function loadEditSchedules() {
            if (!isAuthenticated) return;
            
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            const editContainer = document.getElementById('edit-schedules');
            
            editContainer.innerHTML = '';
            
            if (schedules.length === 0) {
                editContainer.innerHTML = '<p class="empty-state">Belum ada jadwal untuk dikelola</p>';
                return;
            }
            
            // Urutkan jadwal berdasarkan tanggal
            schedules.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            schedules.forEach((schedule, index) => {
                const scheduleDiv = document.createElement('div');
                scheduleDiv.style.border = '1px solid #ddd';
                scheduleDiv.style.padding = '10px';
                scheduleDiv.style.margin = '10px 0';
                scheduleDiv.style.borderRadius = '4px';
                
                const scheduleDate = new Date(schedule.date);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let dateStatus = '';
                if (scheduleDate.getTime() === today.getTime()) {
                    dateStatus = '<span class="badge badge-today">Hari Ini</span>';
                } else if (scheduleDate > today) {
                    dateStatus = '<span class="badge badge-upcoming">Mendatang</span>';
                } else {
                    dateStatus = '<span class="badge badge-past">Sudah Lewat</span>';
                }
                
                scheduleDiv.innerHTML = `
                    <h4>Jadwal #${index + 1} ${dateStatus}</h4>
                    <input type="date" value="${schedule.date}" id="edit-date-${index}">
                    <input type="time" value="${schedule.time}" id="edit-time-${index}">
                    <input type="text" value="${schedule.location}" id="edit-location-${index}" placeholder="Lokasi">
                    <textarea id="edit-activity-${index}" placeholder="Deskripsi Kegiatan">${schedule.activity}</textarea>
                    <input type="text" value="${schedule.person}" id="edit-person-${index}" placeholder="Penanggung Jawab">
                    <button onclick="updateSchedule(${index})">Perbarui</button>
                    <button onclick="deleteSchedule(${index})" class="btn-danger">Hapus</button>
                `;
                
                editContainer.appendChild(scheduleDiv);
            });
        }
        
        // Menambah jadwal baru
        function addSchedule() {
            if (!isAuthenticated) {
                showNotification('Anda harus login terlebih dahulu!', 'error');
                return;
            }
            
            const newDate = document.getElementById('new-date').value;
            const newTime = document.getElementById('new-time').value;
            const newLocation = document.getElementById('new-location').value;
            const newActivity = document.getElementById('new-activity').value;
            const newPerson = document.getElementById('new-person').value;
            
            if (!newDate || !newTime || !newLocation || !newActivity || !newPerson) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }
            
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            schedules.push({
                date: newDate,
                time: newTime,
                location: newLocation,
                activity: newActivity,
                person: newPerson
            });
            
            localStorage.setItem('workSchedules', JSON.stringify(schedules));
            
            // Reset form
            document.getElementById('new-date').value = '';
            document.getElementById('new-time').value = '';
            document.getElementById('new-location').value = '';
            document.getElementById('new-activity').value = '';
            document.getElementById('new-person').value = '';
            
            showNotification('Jadwal berhasil ditambahkan!', 'success');
            loadSchedules(currentFilter);
            loadEditSchedules();
        }
        
        // Memperbarui jadwal
        function updateSchedule(index) {
            if (!isAuthenticated) return;
            
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            
            if (index >= schedules.length) {
                showNotification('Indeks jadwal tidak valid!', 'error');
                return;
            }
            
            schedules[index] = {
                date: document.getElementById(`edit-date-${index}`).value,
                time: document.getElementById(`edit-time-${index}`).value,
                location: document.getElementById(`edit-location-${index}`).value,
                activity: document.getElementById(`edit-activity-${index}`).value,
                person: document.getElementById(`edit-person-${index}`).value
            };
            
            localStorage.setItem('workSchedules', JSON.stringify(schedules));
            showNotification('Jadwal berhasil diperbarui!', 'success');
            loadSchedules(currentFilter);
            loadEditSchedules();
        }
        
        // Menghapus jadwal
        function deleteSchedule(index) {
            if (!isAuthenticated) return;
            
            if (!confirm('Apakah Anda yakin ingin menghapus jadwal ini?')) {
                return;
            }
            
            const schedules = JSON.parse(localStorage.getItem('workSchedules')) || [];
            schedules.splice(index, 1);
            localStorage.setItem('workSchedules', JSON.stringify(schedules));
            
            showNotification('Jadwal berhasil dihapus!', 'success');
            loadSchedules(currentFilter);
            loadEditSchedules();
        }
        
        // Memuat jadwal saat halaman pertama kali dibuka
        document.addEventListener('DOMContentLoaded', function() {
            loadSchedules('today');
            
            // Set nilai default untuk input tanggal baru ke hari ini
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('new-date').value = formattedDate;
            
            // Set nilai default untuk input waktu ke jam berikutnya
            const nextHour = today.getHours() + 1;
            document.getElementById('new-time').value = `${nextHour.toString().padStart(2, '0')}:00`;
        });
    </script>
</body>
</html>
